(this["webpackJsonptnxkalimbatabs-react-mongodb-atlas"]=this["webpackJsonptnxkalimbatabs-react-mongodb-atlas"]||[]).push([[0],{117:function(e,t,n){e.exports={addSong:"addsong_addSong__2UKIG"}},119:function(e,t,n){e.exports={editSong:"editsong_editSong__3NsqR"}},132:function(e,t,n){},245:function(e,t,n){"use strict";n.r(t);var a,r=n(0),c=n.n(r),i=n(25),o=n.n(i),s=(n(132),n(3)),l=n.n(s),u=n(12),d=n(5),j=n(249),b=n(251),O=n(247),f=n(254),p=n(117),h=n.n(p),x=n(55),m=n.n(x),g=n(1),v=function(e){var t=e.open,n=e.modalLabel,a=e.children,r=e.custom_modal,c=e.onClose;return t?Object(g.jsx)("div",{className:m.a.modalContainer,onClick:function(e){return"modalContainer"===e.target.className&&c(!1),null},children:Object(g.jsxs)("div",{className:"".concat(m.a.modal," ").concat(r),children:[Object(g.jsxs)("div",{className:m.a.modal__head,children:[Object(g.jsx)("h2",{children:n}),Object(g.jsx)("span",{className:m.a.modal__close,onClick:function(){return c(!1)},children:"x"})]}),a]})}):null},_=n(52),C=n(54),y=n(91),S=n.n(y),k=["unknown","beginner","intermediate","advanced"],E=function(e){var t=e.title,n=e.rating,a=e.onChange,c=Object(r.useMemo)((function(){for(var e=[],t=function(t){e.push(Object(g.jsx)(C.a,{icon:_.b,className:"".concat(n&&n>t?S.a.rating__checked:""),onClick:function(){return e=t+1,void(a&&a(e));var e}},"rating-"+t))},r=0;r<3;r++)t(r);return e}),[n,a]);return Object(g.jsxs)("span",{title:k[n||0],className:S.a.rating__box,children:[t,c]})},N={app:null,client:void 0,user:null,setApp:function(){},setClient:function(){},setUser:function(){}},w=c.a.createContext(N);!function(e){e[e.NUMBER=0]="NUMBER",e[e.C_TUNE=1]="C_TUNE",e[e.G_TUNE=2]="G_TUNE"}(a||(a={}));var U="kontranik",P="ktabs",T=10,F=(a.NUMBER,function(e){var t=e.onClose,n=e.open,a=Object(r.useContext)(w),c=Object(r.useRef)(null);Object(r.useEffect)((function(){(null===c||void 0===c?void 0:c.current)&&c.current.focus()}),[]);var i=Object(r.useState)(""),o=Object(d.a)(i,2),s=o[0],l=o[1],u=Object(r.useState)(""),j=Object(d.a)(u,2),b=j[0],O=j[1],f=Object(r.useState)(""),p=Object(d.a)(f,2),x=p[0],m=p[1],_=Object(r.useState)(""),C=Object(d.a)(_,2),y=C[0],S=C[1],k=Object(r.useState)(0),N=Object(d.a)(k,2),T=N[0],F=N[1],L=Object(r.useState)(""),A=Object(d.a)(L,2),D=A[0],I=A[1];return Object(g.jsxs)(v,{modalLabel:"Add Kalimba Tabulature",onClose:t,open:n,children:[Object(g.jsx)(E,{title:"Set difficulty: ",rating:T,onChange:F}),Object(g.jsxs)("form",{onSubmit:function(e){var n;if(e.preventDefault(),s&&0!==s.trim().length)if(D&&0!==D.trim().length){var r,c={title:s,interpreter:b.trim(),source:x.trim(),youtube:y.trim(),text:D,difficulty:T,updated:new Date};if(a.client&&(null===(n=a.app)||void 0===n?void 0:n.currentUser))(null===(r=a.client)||void 0===r?void 0:r.db(U).collection(P)).insertOne(c).then((function(){t(!0)})).catch((function(e){alert(e),t(!1)}))}else alert("Enter song text");else alert("Enter title text")},className:h.a.addSong,name:"addSong",children:[Object(g.jsx)("input",{ref:c,type:"text",name:"title",onChange:function(e){return l(e.target.value)},value:s,placeholder:"Enter title"}),Object(g.jsx)("input",{type:"text",name:"interpreter",onChange:function(e){return O(e.target.value)},value:b,placeholder:"interpreter"}),Object(g.jsx)("textarea",{onChange:function(e){return I(e.target.value)},placeholder:"Enter song text",value:D}),Object(g.jsx)("input",{type:"url",name:"source",onChange:function(e){return m(e.target.value)},value:x,placeholder:"source"}),Object(g.jsx)("input",{type:"url",name:"youtube",onChange:function(e){return S(e.target.value)},value:y,placeholder:"youtube"}),Object(g.jsx)("button",{type:"submit",children:"Save"})]})]})}),L=n(253),A=function(e){var t=e.onSearch,n=Object(r.useState)(""),a=Object(d.a)(n,2),c=a[0],i=a[1];return Object(g.jsxs)(L.a,{className:"mt-3",children:[Object(g.jsx)(b.a.Control,{"aria-label":"search in title or interpreter",placeholder:"search in title or interpreter",onChange:function(e){return i(e.target.value)},value:c}),Object(g.jsx)(O.a,{variant:"outline-primary",onClick:function(){t(c)},children:"Find"}),Object(g.jsx)(O.a,{variant:"outline-danger",onClick:function(){i(""),t("")},children:"Clear"})]})},D=n(2),I=n(24),R=function(){console.log(Object({NODE_ENV:"production",PUBLIC_URL:"https://tnxec2.github.io/KalimbaTabs-static",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_REALM_APIKEY_READALL:"59Munl84g4gm21htidfyUzE6rfe9Z1KfcIdeoWFucaoyvsaDKndGSc6UeU5FEZqy",REACT_APP_REALM_APP_ID:"kalimbatabs-htpbq"}));var e="59Munl84g4gm21htidfyUzE6rfe9Z1KfcIdeoWFucaoyvsaDKndGSc6UeU5FEZqy";return I.c.apiKey(e)},K=function(e){return!e||"api-key"===e.identities[0].providerType},M=n(119),B=n.n(M),G=function(e){var t=e.open,n=e.onClose,a=e.toEditTitle,c=e.toEditInterpreter,i=e.toEditSource,o=e.toEditYoutube,s=e.toEditSongtext,j=e.toEditDifficulty,b=e.id,O=Object(r.useContext)(w),f=Object(r.useState)(a),p=Object(d.a)(f,2),h=p[0],x=p[1],m=Object(r.useState)(c),_=Object(d.a)(m,2),C=_[0],y=_[1],S=Object(r.useState)(i),k=Object(d.a)(S,2),N=k[0],T=k[1],F=Object(r.useState)(o),L=Object(d.a)(F,2),A=L[0],D=L[1],R=Object(r.useState)(s),K=Object(d.a)(R,2),M=K[0],G=K[1],q=Object(r.useState)(j),W=Object(d.a)(q,2),V=W[0],Z=W[1],z=function(){var e=Object(u.a)(l.a.mark((function e(t){var a,r,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),h&&0!==h.trim().length){e.next=4;break}return alert("Enter title text"),e.abrupt("return");case 4:if(M&&0!==M.trim().length){e.next=7;break}return alert("Enter song text"),e.abrupt("return");case 7:r={title:h,interpreter:C,source:N,youtube:A,text:M,difficulty:V,updated:new Date},O.client&&(null===(a=O.app)||void 0===a?void 0:a.currentUser)&&(null===(c=O.client)||void 0===c?void 0:c.db(U).collection(P)).updateOne({_id:new I.b.ObjectID(b)},r).then((function(){n(!0)})).catch((function(e){alert(e),n(!1)}));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(g.jsxs)(v,{modalLabel:"Edit Kalimba Tab",onClose:n,open:t,children:[Object(g.jsx)(E,{title:"Set difficulty: ",rating:V,onChange:Z}),Object(g.jsxs)("form",{onSubmit:z,className:B.a.editSong,children:[Object(g.jsx)("input",{type:"text",name:"title",placeholder:"title",onChange:function(e){return x(e.target.value)},value:h}),Object(g.jsx)("input",{type:"text",name:"interpreter",placeholder:"interpreter",onChange:function(e){return y(e.target.value)},value:C}),Object(g.jsx)("textarea",{onChange:function(e){return G(e.target.value)},placeholder:"Enter song text",value:M,children:M}),Object(g.jsx)("input",{type:"url",name:"source",placeholder:"source",onChange:function(e){return T(e.target.value)},value:N}),Object(g.jsx)("input",{type:"url",name:"youtube",placeholder:"youtube link",onChange:function(e){return D(e.target.value)},value:A}),Object(g.jsx)("button",{type:"submit",children:"Save"})]})]})},q=n(57),W=n.n(q),V=function(e){var t=e.onClose,n=e.open,a=e.song,c=Object(r.useContext)(w),i=Object(r.useMemo)((function(){return a.text.split("\n").map((function(e){return e.startsWith(">")?e.substring(1,e.length):e})).join("\n")}),[a.text]),o=function(){var e=Object(u.a)(l.a.mark((function e(){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.confirm("Are you sure to delete this song?")){e.next=2;break}return e.abrupt("return");case 2:c.client&&(null===(n=c.app)||void 0===n?void 0:n.currentUser)&&(null===(r=c.client)||void 0===r?void 0:r.db(U).collection(P)).deleteOne({_id:new I.b.ObjectID(a._id)}).then((function(){return t(!0)})).catch((function(e){return alert(e)}));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(g.jsxs)(v,{modalLabel:a.title,onClose:t,open:n,children:[Object(g.jsx)("div",{title:"Interpreter",className:W.a.interpreter,children:a.interpreter.length>0?a.interpreter:"unknown"}),Object(g.jsx)(E,{title:"Difficulty: ",rating:a.difficulty}),Object(g.jsxs)("div",{className:W.a.song,children:[Object(g.jsx)("div",{className:W.a.song_songtext,children:i}),Object(g.jsxs)("div",{children:[a.source.length>0?Object(g.jsxs)("div",{children:[Object(g.jsx)(C.a,{icon:_.a})," ",Object(g.jsx)("a",{href:a.source,children:a.source})]}):"",a.youtube.length>0?Object(g.jsxs)("div",{children:[Object(g.jsx)(C.a,{icon:_.c})," ",Object(g.jsx)("a",{href:a.youtube,children:a.youtube})]}):""]}),Object(g.jsx)("div",{className:W.a.song_buttons,children:K(c.user)?"":Object(g.jsx)(g.Fragment,{children:Object(g.jsx)(O.a,{variant:"outline-danger",onClick:o,children:"Delete"})})})]})]})},Z=function(e){var t=e.ktab,n=e.user,a=e.onReload,c=Object(r.useState)({edit:!1,view:!1}),i=Object(d.a)(c,2),o=i[0],s=i[1],l=function(e){s({edit:!1,view:!1}),e&&a()};return Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)(f.a.Item,{as:"li",className:"align-items-start",children:Object(g.jsxs)("div",{className:"d-flex justify-content-between",children:[Object(g.jsxs)("div",{children:[Object(g.jsx)("div",{className:"font-weight-bolder",children:t.title}),t.interpreter.length>0?Object(g.jsx)("div",{className:"text-muted font-italic",children:t.interpreter}):""]}),Object(g.jsxs)("div",{children:[Object(g.jsx)(E,{title:"",rating:t.difficulty}),K(n)?"":Object(g.jsx)(O.a,{variant:"primary",onClick:function(){return s(Object(D.a)(Object(D.a)({},o),{},{view:!1,edit:!0}))},className:"ms-3",children:"Edit"}),Object(g.jsx)(O.a,{variant:"success",onClick:function(){return s(Object(D.a)(Object(D.a)({},o),{},{view:!0,edit:!1}))},className:"ms-3",children:"View"})]})]})}),o.view&&Object(g.jsx)(V,{onClose:l,song:t,open:o.view}),o.edit&&Object(g.jsx)(G,{onClose:l,toEditTitle:t.title,toEditInterpreter:t.interpreter,toEditSongtext:t.text,toEditSource:t.source,toEditYoutube:t.youtube,toEditDifficulty:t.difficulty,id:t._id,open:o.edit})]})},z=n(248),H=function(){return Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)(z.a,{animation:"border",variant:"primary",children:Object(g.jsx)("span",{className:"sr-only"})})," Loading..."]})},Y=n(92),J=n.n(Y),$=function(e){var t=e.currentPage,n=e.total,a=e.countPerPage,c=e.onChangePage,i=Object(r.useMemo)((function(){return Math.floor(n/a)}),[n,a]),o=Object(r.useMemo)((function(){for(var e=[],n=Math.max(0,t-3),a=Math.min(i,t+3),r=n;r<=a;r++)e.push(r);return e}),[i,t]);return Object(g.jsx)(g.Fragment,{children:n>0?Object(g.jsxs)("div",{className:J.a.pagination,children:[t>0?Object(g.jsx)("span",{onClick:function(){return c(t-1)},children:"\xab"}):"",o.map((function(e){return Object(g.jsx)("span",{className:"".concat(t===e?J.a.active:""),onClick:function(){return c(e)},children:e+1},"page-"+e)})),t<i?Object(g.jsx)("span",{onClick:function(){return c(t+1)},children:"\xbb"}):""]}):""})};var Q=function(){var e=Object(r.useContext)(w),t=Object(r.useState)([]),n=Object(d.a)(t,2),a=n[0],c=n[1],i=Object(r.useState)(!0),o=Object(d.a)(i,2),s=o[0],l=o[1],u=Object(r.useState)(!1),p=Object(d.a)(u,2),h=p[0],x=p[1],m=Object(r.useState)(""),v=Object(d.a)(m,2),_=v[0],C=v[1],y=Object(r.useState)(0),S=Object(d.a)(y,2),k=S[0],E=S[1],N=Object(r.useState)(0),L=Object(d.a)(N,2),D=L[0],I=L[1],R=Object(r.useState)({}),M=Object(d.a)(R,2),B=M[0],G=M[1],q=Object(r.useState)(!1),W=Object(d.a)(q,2),V=W[0],z=W[1],Y=Object(r.useState)("title"),J=Object(d.a)(Y,2),Q=J[0],X=J[1];return Object(r.useEffect)((function(){if(e.client){var t=e.client.db(U).collection(P),n=new RegExp(_,"i"),a=_.trim().length>0?{$or:[{title:{$regex:n}},{interpreter:{$regex:n}}]}:{};G(a),t.count(a).then((function(e){return E(e)})).catch((function(e){return console.log(e)}))}}),[_,e,V]),Object(r.useEffect)((function(){if(e.user){var t;l(!0);var n={};switch(Q){case"title":n={title:1,_id:1};break;case"interpreter":n={interpreter:1,title:1,_id:1};break;case"difficulty":n={difficulty:1,title:1,_id:1};break;case"updated":n={updated:-1,_id:1};break;case"difficulty_desc":n={difficulty:-1,title:1,_id:1};break;default:n={title:1,_id:1}}var a={skip:D*T,limit:T,filter:B,sort:n};null===(t=e.user)||void 0===t||t.callFunction("skip_limit",a).then((function(e){c(e.data)})).catch((function(e){return console.log(e)})).finally((function(){return l(!1)}))}}),[e.user,B,D,V,Q]),Object(g.jsxs)(j.a,{children:[Object(g.jsx)(A,{onSearch:function(e){I(0),C(e)}}),s&&Object(g.jsx)("div",{className:"text-center",children:Object(g.jsx)(H,{})}),Object(g.jsxs)(j.a,{className:"d-flex justify-content-between mt-3",children:[Object(g.jsxs)("div",{children:["Total: ",k]}),Object(g.jsxs)("div",{className:"d-flex",children:[Object(g.jsx)(b.a.Label,{children:"sort by "}),Object(g.jsxs)(b.a.Select,{"aria-label":"sort selection",size:"sm",onChange:function(e){return X(e.target.value)},children:[Object(g.jsx)("option",{value:"title",children:"title"}),Object(g.jsx)("option",{value:"interpreter",children:"interpreter"}),Object(g.jsx)("option",{value:"updated",children:"update time"}),Object(g.jsx)("option",{value:"difficulty",children:"difficulty"}),Object(g.jsx)("option",{value:"difficulty_desc",children:"difficulty desc"})]}),K(e.user)?"":Object(g.jsx)(O.a,{size:"sm",className:"ms-3",variant:"outline-dark",onClick:function(){return x(!0)},children:"Add song"})]})]}),Object(g.jsx)(f.a,{as:"ul",className:"mt-3 mb-3",children:a.map((function(t){return Object(g.jsx)(Z,{ktab:t,user:e.user,onReload:function(){return z(!V)}},t._id)}))}),Object(g.jsx)($,{currentPage:D,total:k,countPerPage:T,onChangePage:I}),h&&Object(g.jsx)(F,{onClose:function(e){x(!1),e&&z(!V)},open:h})]})},X=(n(142),n(250)),ee=n(252),te=n(125),ne=n(80),ae=ne.a().shape({email:ne.b().email().required(),password:ne.b().required()}),re=function(e){var t=e.onLogin,n=Object(r.useContext)(w),a=Object(r.useState)(!1),c=Object(d.a)(a,2),i=c[0],o=c[1];function s(){return(s=Object(u.a)(l.a.mark((function e(a){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o(!0),r=I.c.emailPassword(a.email,a.password),n.app?(console.log("login..."),n.app.logIn(r).then((function(e){n.setUser(e),console.log("logged in..."),t()})).catch((function(e){return alert(e)}))):n.setUser(null),o(!1);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(g.jsx)(j.a,{className:"d-flex justify-content-center mt-3",children:Object(g.jsx)(te.a,{initialValues:{email:"",password:""},validationSchema:ae,onSubmit:function(e){return s.apply(this,arguments)},children:function(e){var t=e.errors,n=e.touched,a=e.handleSubmit,r=e.values,c=e.handleChange;return Object(g.jsxs)(b.a,{noValidate:!0,onSubmit:a,children:[i&&Object(g.jsx)(H,{}),!i&&Object(g.jsxs)("div",{children:[Object(g.jsx)("h1",{children:"Login"}),Object(g.jsxs)(b.a.Group,{children:[Object(g.jsx)(b.a.Label,{children:"Email"}),Object(g.jsx)(b.a.Control,{type:"email",name:"email",value:r.email,onChange:c,isValid:n.email&&!t.email}),Object(g.jsx)(b.a.Control.Feedback,{children:t.email})]}),Object(g.jsxs)(b.a.Group,{children:[Object(g.jsx)(b.a.Label,{children:"Password"}),Object(g.jsx)(b.a.Control,{type:"password",name:"password",value:r.password,onChange:c,isValid:n.password&&!t.password}),Object(g.jsx)(b.a.Control.Feedback,{children:t.password})]}),Object(g.jsx)("div",{className:"text-center mt-2",children:Object(g.jsx)(O.a,{variant:"primary",type:"submit",children:"Submit"})})]})]})}})})},ce=function(){var e,t,n=Object(r.useContext)(w),a=Object(r.useMemo)((function(){return!K(n.user)}),[n.user]),c=Object(r.useState)(!1),i=Object(d.a)(c,2),o=i[0],s=i[1];function j(){return(j=Object(u.a)(l.a.mark((function e(){var t,a,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s(!1),console.log("logout"),!(null===(t=n.app)||void 0===t?void 0:t.currentUser)){e.next=17;break}return e.next=5,n.app.currentUser.logOut();case 5:return e.prev=5,e.next=8,n.app.logIn(R());case 8:r=e.sent,console.log("Successfully logged in!",r.id),n.setUser(r),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(5),e.t0 instanceof Error&&console.error("Failed to log in",e.t0.message);case 16:n.setClient(null===(a=n.app.currentUser)||void 0===a?void 0:a.mongoClient("mongodb-atlas"));case 17:case"end":return e.stop()}}),e,null,[[5,13]])})))).apply(this,arguments)}return Object(g.jsxs)(g.Fragment,{children:[Object(g.jsxs)(X.a,{bg:"light",expand:"lg",children:[Object(g.jsx)(X.a.Brand,{href:"/",children:"Tnx Kalimba Tabs"}),Object(g.jsx)(ee.a,{className:"ms-auto",children:a?Object(g.jsxs)(X.a.Collapse,{className:"justify-content-end",children:[Object(g.jsx)(X.a.Text,{children:(null===(e=n.user)||void 0===e?void 0:e.profile.name)||(null===(t=n.user)||void 0===t?void 0:t.profile.email)}),Object(g.jsx)("a",{href:"/#",className:"mx-2",onClick:function(){return function(){return j.apply(this,arguments)}()},children:"Log out"})]}):Object(g.jsx)("a",{href:"/#",className:"mx-2",onClick:function(){return s(!0)},children:"Sign In"})})]}),o?Object(g.jsx)(re,{onLogin:function(){return s(!1)}}):""]})};var ie=function(){var e=Object(r.useState)(),t=Object(d.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)(null),i=Object(d.a)(c,2),o=i[0],s=i[1],j=Object(r.useState)(new I.a({id:"kalimbatabs-htpbq"})),b=Object(d.a)(j,2),O=b[0],f=b[1];return Object(r.useEffect)((function(){function e(){return(e=Object(u.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o){e.next=11;break}if(e.t0=s,!O.currentUser){e.next=6;break}e.t1=O.currentUser,e.next=9;break;case 6:return e.next=8,O.logIn(R());case 8:e.t1=e.sent;case 9:e.t2=e.t1,(0,e.t0)(e.t2);case 11:n||a(null===O||void 0===O||null===(t=O.currentUser)||void 0===t?void 0:t.mongoClient("mongodb-atlas"));case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[O,n,o]),Object(g.jsx)(g.Fragment,{children:Object(g.jsxs)(w.Provider,{value:{app:O,client:n,user:o,setClient:a,setUser:s,setApp:f},children:[Object(g.jsx)(ce,{}),Object(g.jsx)(Q,{})]})})},oe=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,255)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),a(e),r(e),c(e),i(e)}))};o.a.render(Object(g.jsx)(c.a.StrictMode,{children:Object(g.jsx)(ie,{})}),document.getElementById("root")),oe()},55:function(e,t,n){e.exports={modalContainer:"modal_modalContainer__njSGn",modal:"modal_modal__1zCPQ",modal__head:"modal_modal__head__2A6uI",modal__close:"modal_modal__close__39gZa"}},57:function(e,t,n){e.exports={song:"song_song__3UfjZ",interpreter:"song_interpreter__2aum8",song_songtext:"song_song_songtext__nBJBj",song_buttons:"song_song_buttons__22HKA",song__deleteButton:"song_song__deleteButton__1lnj0"}},91:function(e,t,n){e.exports={rating__checked:"rating_rating__checked__3Y5gl"}},92:function(e,t,n){e.exports={pagination:"pagination_pagination__3nFKa",disabled:"pagination_disabled__1WPUm",active:"pagination_active__HNOaS"}}},[[245,1,2]]]);
//# sourceMappingURL=main.6e4a7e7b.chunk.js.map