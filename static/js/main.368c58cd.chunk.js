(this["webpackJsonptnxkalimbatabs-react-mongodb-atlas"]=this["webpackJsonptnxkalimbatabs-react-mongodb-atlas"]||[]).push([[0],{117:function(e,t,n){e.exports={addSong:"addsong_addSong__2UKIG"}},118:function(e,t,n){e.exports={editSong:"editsong_editSong__3NsqR"}},132:function(e,t,n){},245:function(e,t,n){"use strict";n.r(t);var a,r=n(0),c=n.n(r),i=n(25),o=n.n(i),l=(n(132),n(3)),s=n.n(l),u=n(12),d=n(5),j=n(249),b=n(251),p=n(247),f=n(254),O=n(117),h=n.n(O),x=n(55),g=n.n(x),m=n(1),v=function(e){var t=e.open,n=e.modalLabel,a=e.children,r=e.custom_modal,c=e.onClose;return t?Object(m.jsx)("div",{className:g.a.modalContainer,onClick:function(e){return"modalContainer"===e.target.className&&c(!1),null},children:Object(m.jsxs)("div",{className:"".concat(g.a.modal," ").concat(r),children:[Object(m.jsxs)("div",{className:g.a.modal__head,children:[Object(m.jsx)("h2",{children:n}),Object(m.jsx)("span",{className:g.a.modal__close,onClick:function(){return c(!1)},children:"x"})]}),a]})}):null},_=n(52),y=n(54),C=n(91),S=n.n(C),k=["unknown","beginner","intermediate","advanced"],w=function(e){var t=e.title,n=e.rating,a=e.onChange,c=Object(r.useMemo)((function(){for(var e=[],t=function(t){e.push(Object(m.jsx)(y.a,{icon:_.b,className:"".concat(n&&n>t?S.a.rating__checked:""),onClick:function(){return e=t+1,void(a&&a(e));var e}},"rating-"+t))},r=0;r<3;r++)t(r);return e}),[n,a]);return Object(m.jsxs)("span",{title:k[n||0],className:S.a.rating__box,children:[t,c]})},N={app:null,user:null,setApp:function(){},setUser:function(){}},E=c.a.createContext(N);!function(e){e[e.NUMBER=0]="NUMBER",e[e.C_TUNE=1]="C_TUNE",e[e.G_TUNE=2]="G_TUNE"}(a||(a={}));var U="mongodb-atlas",L="kontranik",I="ktabs",F=10,P=(a.NUMBER,function(e){var t=e.onClose,n=e.open,a=Object(r.useContext)(E),c=Object(r.useRef)(null);Object(r.useEffect)((function(){(null===c||void 0===c?void 0:c.current)&&c.current.focus()}),[]);var i=Object(r.useState)(""),o=Object(d.a)(i,2),l=o[0],s=o[1],u=Object(r.useState)(""),j=Object(d.a)(u,2),b=j[0],p=j[1],f=Object(r.useState)(""),O=Object(d.a)(f,2),x=O[0],g=O[1],_=Object(r.useState)(""),y=Object(d.a)(_,2),C=y[0],S=y[1],k=Object(r.useState)(0),N=Object(d.a)(k,2),F=N[0],P=N[1],M=Object(r.useState)(""),T=Object(d.a)(M,2),D=T[0],B=T[1];return Object(m.jsxs)(v,{modalLabel:"Add Kalimba Tabulature",onClose:t,open:n,children:[Object(m.jsx)(w,{title:"Set difficulty: ",rating:F,onChange:P}),Object(m.jsxs)("form",{onSubmit:function(e){var n,r;if(e.preventDefault(),l&&0!==l.trim().length)if(D&&0!==D.trim().length){var c,i,o,s={title:l,interpreter:b.trim(),source:x.trim(),youtube:C.trim(),text:D,difficulty:F,updated:new Date};if(null===(n=a.app)||void 0===n||null===(r=n.currentUser)||void 0===r?void 0:r.isLoggedIn)(null===(c=a.app)||void 0===c||null===(i=c.currentUser)||void 0===i||null===(o=i.mongoClient(U))||void 0===o?void 0:o.db(L).collection(I)).insertOne(s).then((function(){t(!0)})).catch((function(e){alert(e),t(!1)}))}else alert("Enter song text");else alert("Enter title text")},className:h.a.addSong,name:"addSong",children:[Object(m.jsx)("input",{ref:c,type:"text",name:"title",onChange:function(e){return s(e.target.value)},value:l,placeholder:"Enter title"}),Object(m.jsx)("input",{type:"text",name:"interpreter",onChange:function(e){return p(e.target.value)},value:b,placeholder:"interpreter"}),Object(m.jsx)("textarea",{onChange:function(e){return B(e.target.value)},placeholder:"Enter song text",value:D}),Object(m.jsx)("input",{type:"url",name:"source",onChange:function(e){return g(e.target.value)},value:x,placeholder:"source"}),Object(m.jsx)("input",{type:"url",name:"youtube",onChange:function(e){return S(e.target.value)},value:C,placeholder:"youtube"}),Object(m.jsx)("button",{type:"submit",children:"Save"})]})]})}),M=n(253),T=function(e){var t=e.onSearch,n=Object(r.useState)(""),a=Object(d.a)(n,2),c=a[0],i=a[1];return Object(m.jsxs)(M.a,{className:"mt-3",children:[Object(m.jsx)(b.a.Control,{"aria-label":"search in title or interpreter",placeholder:"search in title or interpreter",onChange:function(e){return i(e.target.value)},value:c}),Object(m.jsx)(p.a,{variant:"outline-primary",onClick:function(){t(c)},children:"Find"}),Object(m.jsx)(p.a,{variant:"outline-danger",onClick:function(){i(""),t("")},children:"Clear"})]})},D=n(2),B=n(118),K=n.n(B),G=n(24),R=function(e){var t=e.open,n=e.onClose,a=e.toEditTitle,c=e.toEditInterpreter,i=e.toEditSource,o=e.toEditYoutube,l=e.toEditSongtext,j=e.toEditDifficulty,b=e.id,p=Object(r.useContext)(E),f=Object(r.useState)(a),O=Object(d.a)(f,2),h=O[0],x=O[1],g=Object(r.useState)(c),_=Object(d.a)(g,2),y=_[0],C=_[1],S=Object(r.useState)(i),k=Object(d.a)(S,2),N=k[0],F=k[1],P=Object(r.useState)(o),M=Object(d.a)(P,2),T=M[0],D=M[1],B=Object(r.useState)(l),R=Object(d.a)(B,2),A=R[0],q=R[1],z=Object(r.useState)(j),V=Object(d.a)(z,2),Z=V[0],J=V[1],W=function(){var e=Object(u.a)(s.a.mark((function e(t){var a,r,c,i,o,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),h&&0!==h.trim().length){e.next=4;break}return alert("Enter title text"),e.abrupt("return");case 4:if(A&&0!==A.trim().length){e.next=7;break}return alert("Enter song text"),e.abrupt("return");case 7:r={title:h,interpreter:y,source:N,youtube:T,text:A,difficulty:Z,updated:new Date},(null===(a=p.app)||void 0===a?void 0:a.currentUser)&&(l=null===(c=p.app)||void 0===c||null===(i=c.currentUser)||void 0===i?void 0:i.mongoClient(U).db(L).collection(I),console.log("update",null===(o=p.app)||void 0===o?void 0:o.currentUser),l.updateOne({_id:new G.b.ObjectID(b)},r).then((function(){n(!0)})).catch((function(e){alert(e),n(!1)})));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(m.jsxs)(v,{modalLabel:"Edit Kalimba Tab",onClose:n,open:t,children:[Object(m.jsx)(w,{title:"Set difficulty: ",rating:Z,onChange:J}),Object(m.jsxs)("form",{onSubmit:W,className:K.a.editSong,children:[Object(m.jsx)("input",{type:"text",name:"title",placeholder:"title",onChange:function(e){return x(e.target.value)},value:h}),Object(m.jsx)("input",{type:"text",name:"interpreter",placeholder:"interpreter",onChange:function(e){return C(e.target.value)},value:y}),Object(m.jsx)("textarea",{onChange:function(e){return q(e.target.value)},placeholder:"Enter song text",value:A,children:A}),Object(m.jsx)("input",{type:"url",name:"source",placeholder:"source",onChange:function(e){return F(e.target.value)},value:N}),Object(m.jsx)("input",{type:"url",name:"youtube",placeholder:"youtube link",onChange:function(e){return D(e.target.value)},value:T}),Object(m.jsx)("button",{type:"submit",children:"Save"})]})]})},A=n(57),q=n.n(A),z=function(e){var t=e.onClose,n=e.open,a=e.song,c=e.readOnly,i=Object(r.useContext)(E),o=Object(r.useMemo)((function(){return a.text.split("\n").map((function(e){return e.startsWith(">")?e.substring(1,e.length):e})).join("\n")}),[a.text]),l=function(){var e=Object(u.a)(s.a.mark((function e(){var n,r,c,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.confirm("Are you sure to delete this song?")){e.next=2;break}return e.abrupt("return");case 2:(null===(n=i.app)||void 0===n?void 0:n.currentUser)&&(null===(r=i.app)||void 0===r||null===(c=r.currentUser)||void 0===c||null===(o=c.mongoClient(U))||void 0===o?void 0:o.db(L).collection(I)).deleteOne({_id:new G.b.ObjectID(a._id)}).then((function(){return t(!0)})).catch((function(e){return alert(e)}));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(m.jsxs)(v,{modalLabel:a.title,onClose:t,open:n,children:[Object(m.jsx)("div",{title:"Interpreter",className:q.a.interpreter,children:a.interpreter.length>0?a.interpreter:"unknown"}),Object(m.jsx)(w,{title:"Difficulty: ",rating:a.difficulty}),Object(m.jsxs)("div",{className:q.a.song,children:[Object(m.jsx)("div",{className:q.a.song_songtext,children:o}),Object(m.jsxs)("div",{children:[a.source.length>0?Object(m.jsxs)("div",{children:[Object(m.jsx)(y.a,{icon:_.a})," ",Object(m.jsx)("a",{href:a.source,children:a.source})]}):"",a.youtube.length>0?Object(m.jsxs)("div",{children:[Object(m.jsx)(y.a,{icon:_.c})," ",Object(m.jsx)("a",{href:a.youtube,children:a.youtube})]}):""]}),Object(m.jsx)("div",{className:q.a.song_buttons,children:c?"":Object(m.jsx)(m.Fragment,{children:Object(m.jsx)(p.a,{variant:"outline-danger",onClick:l,children:"Delete"})})})]})]})},V=function(e){var t=e.ktab,n=e.readOnly,a=e.onReload,c=Object(r.useState)({edit:!1,view:!1}),i=Object(d.a)(c,2),o=i[0],l=i[1],s=function(e){l({edit:!1,view:!1}),e&&a()};return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsxs)(f.a.Item,{as:"li",className:"align-items-center d-flex",style:{cursor:"pointer"},children:[Object(m.jsxs)("div",{onClick:function(){return l(Object(D.a)(Object(D.a)({},o),{},{view:!0,edit:!1}))},className:"d-flex justify-content-between",style:{width:"100%",alignItems:"center"},children:[Object(m.jsxs)("div",{children:[Object(m.jsx)("div",{className:"font-weight-bolder",children:t.title}),t.interpreter.length>0?Object(m.jsx)("div",{className:"text-muted font-italic",children:t.interpreter}):""]}),Object(m.jsx)(w,{title:"",rating:t.difficulty})]}),n?"":Object(m.jsx)(p.a,{variant:"outline-primary",onClick:function(){return l(Object(D.a)(Object(D.a)({},o),{},{view:!1,edit:!0}))},className:"ms-3",style:{height:"100%"},children:"Edit"})]}),o.view&&Object(m.jsx)(z,{onClose:s,song:t,open:o.view,readOnly:n}),o.edit&&Object(m.jsx)(R,{onClose:s,toEditTitle:t.title,toEditInterpreter:t.interpreter,toEditSongtext:t.text,toEditSource:t.source,toEditYoutube:t.youtube,toEditDifficulty:t.difficulty,id:t._id,open:o.edit})]})},Z=n(248),J=function(){return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(Z.a,{animation:"border",variant:"primary",children:Object(m.jsx)("span",{className:"sr-only"})})," Loading..."]})},W=n(92),Y=n.n(W),$=function(e){var t=e.currentPage,n=e.total,a=e.countPerPage,c=e.onChangePage,i=Object(r.useMemo)((function(){return Math.floor(n/a)}),[n,a]),o=Object(r.useMemo)((function(){for(var e=[],n=Math.max(0,t-3),a=Math.min(i,t+3),r=n;r<=a;r++)e.push(r);return e}),[i,t]);return Object(m.jsx)(m.Fragment,{children:n>0?Object(m.jsxs)("div",{className:Y.a.pagination,children:[t>0?Object(m.jsx)("span",{onClick:function(){return c(t-1)},children:"\xab"}):"",o.map((function(e){return Object(m.jsx)("span",{className:"".concat(t===e?Y.a.active:""),onClick:function(){return c(e)},children:e+1},"page-"+e)})),t<i?Object(m.jsx)("span",{onClick:function(){return c(t+1)},children:"\xbb"}):""]}):""})},H=function(){var e="59Munl84g4gm21htidfyUzE6rfe9Z1KfcIdeoWFucaoyvsaDKndGSc6UeU5FEZqy";return G.c.apiKey(e)},Q=function(e){return!e||"read_anonym"===e.profile.name};var X=function(){var e,t=Object(r.useContext)(E),n=Object(r.useState)([]),a=Object(d.a)(n,2),c=a[0],i=a[1],o=Object(r.useState)(!0),l=Object(d.a)(o,2),s=l[0],u=l[1],O=Object(r.useState)(!1),h=Object(d.a)(O,2),x=h[0],g=h[1],v=Object(r.useState)(""),_=Object(d.a)(v,2),y=_[0],C=_[1],S=Object(r.useState)(0),k=Object(d.a)(S,2),w=k[0],N=k[1],M=Object(r.useState)(0),D=Object(d.a)(M,2),B=D[0],K=D[1],G=Object(r.useState)({}),R=Object(d.a)(G,2),A=R[0],q=R[1],z=Object(r.useState)(!1),Z=Object(d.a)(z,2),W=Z[0],Y=Z[1],H=Object(r.useState)("title"),X=Object(d.a)(H,2),ee=X[0],te=X[1],ne=Object(r.useMemo)((function(){return Q(t.user)}),[t.user]);return Object(r.useEffect)((function(){var e,n;if(null===(e=t.app)||void 0===e||null===(n=e.currentUser)||void 0===n?void 0:n.isLoggedIn){var a,r,c=null===(a=t.app)||void 0===a||null===(r=a.currentUser)||void 0===r?void 0:r.mongoClient(U).db(L).collection(I),i=new RegExp(y,"i"),o=y.trim().length>0?{$or:[{title:{$regex:i}},{interpreter:{$regex:i}}]}:{};q(o),c.count(o).then((function(e){return N(e)})).catch((function(e){return console.log(e)}))}}),[y,null===(e=t.app)||void 0===e?void 0:e.currentUser,W]),Object(r.useEffect)((function(){var e;if(null===(e=t.user)||void 0===e?void 0:e.isLoggedIn){var n;u(!0);var a={};switch(ee){case"title":a={title:1,_id:1};break;case"interpreter":a={interpreter:1,title:1,_id:1};break;case"difficulty":a={difficulty:1,title:1,_id:1};break;case"updated":a={updated:-1,_id:1};break;case"difficulty_desc":a={difficulty:-1,title:1,_id:1};break;default:a={title:1,_id:1}}var r={skip:B*F,limit:F,filter:A,sort:a};null===(n=t.user)||void 0===n||n.callFunction("skip_limit",r).then((function(e){i(e.data)})).catch((function(e){return console.log(e)})).finally((function(){return u(!1)}))}}),[t.user,A,B,W,ee]),Object(m.jsxs)(j.a,{children:[Object(m.jsx)(T,{onSearch:function(e){K(0),C(e)}}),s&&Object(m.jsx)("div",{className:"text-center",children:Object(m.jsx)(J,{})}),Object(m.jsxs)(j.a,{className:"d-flex justify-content-between mt-3",children:[Object(m.jsxs)("div",{children:["Total: ",w]}),Object(m.jsxs)("div",{className:"d-flex",children:[Object(m.jsx)(b.a.Label,{children:"sort by "}),Object(m.jsxs)(b.a.Select,{"aria-label":"sort selection",size:"sm",onChange:function(e){return te(e.target.value)},children:[Object(m.jsx)("option",{value:"title",children:"title"}),Object(m.jsx)("option",{value:"interpreter",children:"interpreter"}),Object(m.jsx)("option",{value:"updated",children:"update time"}),Object(m.jsx)("option",{value:"difficulty",children:"difficulty"}),Object(m.jsx)("option",{value:"difficulty_desc",children:"difficulty desc"})]}),ne?"":Object(m.jsx)(p.a,{size:"sm",className:"ms-3",variant:"outline-dark",onClick:function(){return g(!0)},children:"Add song"})]})]}),Object(m.jsx)(f.a,{as:"ul",className:"mt-3 mb-3",children:c.map((function(e){return Object(m.jsx)(V,{ktab:e,readOnly:ne,onReload:function(){return Y(!W)}},e._id)}))}),Object(m.jsx)($,{currentPage:B,total:w,countPerPage:F,onChangePage:K}),x&&Object(m.jsx)(P,{onClose:function(e){g(!1),e&&Y(!W)},open:x})]})},ee=(n(142),n(250)),te=n(252),ne=n(125),ae=n(80),re=ae.a().shape({email:ae.b().email().required(),password:ae.b().required()}),ce=function(e){var t=e.onLogin,n=Object(r.useContext)(E),a=Object(r.useState)(!1),c=Object(d.a)(a,2),i=c[0],o=c[1];function l(){return(l=Object(u.a)(s.a.mark((function e(a){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o(!0),n.app?(console.log("login..."),null===(r=n.app.currentUser)||void 0===r||r.logOut().then((function(){var e,r=G.c.emailPassword(a.email,a.password);null===(e=n.app)||void 0===e||e.logIn(r).then((function(e){n.setUser(e),console.log("logged in..."),t()})).catch((function(e){return alert(e)}))})).catch((function(e){console.log("can not logout..."),console.log(e)}))):n.setUser(null),o(!1);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(m.jsx)(j.a,{className:"d-flex justify-content-center mt-3",children:Object(m.jsx)(ne.a,{initialValues:{email:"",password:""},validationSchema:re,onSubmit:function(e){return l.apply(this,arguments)},children:function(e){var t=e.errors,n=e.touched,a=e.handleSubmit,r=e.values,c=e.handleChange;return Object(m.jsxs)(b.a,{noValidate:!0,onSubmit:a,children:[i&&Object(m.jsx)(J,{}),!i&&Object(m.jsxs)("div",{children:[Object(m.jsx)("h1",{children:"Login"}),Object(m.jsxs)(b.a.Group,{children:[Object(m.jsx)(b.a.Label,{children:"Email"}),Object(m.jsx)(b.a.Control,{type:"email",name:"email",value:r.email,onChange:c,isValid:n.email&&!t.email}),Object(m.jsx)(b.a.Control.Feedback,{children:t.email})]}),Object(m.jsxs)(b.a.Group,{children:[Object(m.jsx)(b.a.Label,{children:"Password"}),Object(m.jsx)(b.a.Control,{type:"password",name:"password",value:r.password,onChange:c,isValid:n.password&&!t.password}),Object(m.jsx)(b.a.Control.Feedback,{children:t.password})]}),Object(m.jsx)("div",{className:"text-center mt-2",children:Object(m.jsx)(p.a,{variant:"primary",type:"submit",children:"Submit"})})]})]})}})})},ie=function(){var e,t,n=Object(r.useContext)(E),a=Object(r.useMemo)((function(){return Q(n.user)}),[n.user]),c=Object(r.useState)(!1),i=Object(d.a)(c,2),o=i[0],l=i[1];function j(){return(j=Object(u.a)(s.a.mark((function e(t){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),l(!1),!(null===(a=n.app)||void 0===a?void 0:a.currentUser)){e.next=6;break}return console.log("logout..."),e.next=6,n.app.currentUser.logOut().then((function(){console.log("successfull logged out"),n.setUser(null)})).catch((function(e){console.log(e)}));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsxs)(ee.a,{bg:"light",expand:"lg",children:[Object(m.jsx)(ee.a.Brand,{href:"/",className:"mx-2",children:"Tnx Kalimba Tabs"}),Object(m.jsx)(te.a,{className:"ms-auto",children:a?Object(m.jsx)(ee.a,{children:Object(m.jsx)(te.a.Link,{href:"# ",className:"mx-2",onClick:function(){return l(!0)},children:"Sign In"})}):Object(m.jsxs)(ee.a,{children:[Object(m.jsx)(ee.a.Text,{children:(null===(e=n.user)||void 0===e?void 0:e.profile.name)||(null===(t=n.user)||void 0===t?void 0:t.profile.email)}),Object(m.jsx)(te.a.Link,{href:"# ",className:"mx-2",onClick:function(e){return j.apply(this,arguments)},children:"Log out"})]})})]}),o?Object(m.jsx)(ce,{onLogin:function(){return l(!1)}}):""]})};var oe=function(){var e=Object(r.useState)(null),t=Object(d.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)(new G.a({id:"kalimbatabs-htpbq"})),i=Object(d.a)(c,2),o=i[0],l=i[1];return Object(r.useEffect)((function(){function e(){return(e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=11;break}if(e.t0=a,!o.currentUser){e.next=6;break}e.t1=o.currentUser,e.next=9;break;case 6:return e.next=8,o.logIn(H());case 8:e.t1=e.sent;case 9:e.t2=e.t1,(0,e.t0)(e.t2);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[n,o]),Object(m.jsx)(m.Fragment,{children:Object(m.jsxs)(E.Provider,{value:{app:o,user:n,setUser:a,setApp:l},children:[Object(m.jsx)(ie,{}),Object(m.jsx)(X,{})]})})},le=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,255)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),a(e),r(e),c(e),i(e)}))};o.a.render(Object(m.jsx)(c.a.StrictMode,{children:Object(m.jsx)(oe,{})}),document.getElementById("root")),le()},55:function(e,t,n){e.exports={modalContainer:"modal_modalContainer__njSGn",modal:"modal_modal__1zCPQ",modal__head:"modal_modal__head__2A6uI",modal__close:"modal_modal__close__39gZa"}},57:function(e,t,n){e.exports={song:"song_song__3UfjZ",interpreter:"song_interpreter__2aum8",song_songtext:"song_song_songtext__nBJBj",song_buttons:"song_song_buttons__22HKA",song__deleteButton:"song_song__deleteButton__1lnj0"}},91:function(e,t,n){e.exports={rating__box:"rating_rating__box__jzyGw",rating__checked:"rating_rating__checked__3Y5gl"}},92:function(e,t,n){e.exports={pagination:"pagination_pagination__3nFKa",disabled:"pagination_disabled__1WPUm",active:"pagination_active__HNOaS"}}},[[245,1,2]]]);
//# sourceMappingURL=main.368c58cd.chunk.js.map